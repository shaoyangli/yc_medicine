package com.kh.util;

import org.xvolks.jnative.JNative;
import org.xvolks.jnative.Type;
import org.xvolks.jnative.exceptions.NativeException;
import org.xvolks.jnative.misc.basicStructures.UINT;
import org.xvolks.jnative.pointers.Pointer;
import org.xvolks.jnative.pointers.memory.MemoryBlockFactory;

/**
 * 
 * 功能描述：java调用dll动态库<br>
 * 
 **/
public class EcardReaderImpl {

	/**
	 * 连接
	 * 
	 * @return
	 * @throws NativeException
	 * @throws IllegalAccessException
	 */
	public String Init(int contrast_level, int angle) throws NativeException,
			IllegalAccessException {
		JNative n = null;
		try {
			// 1.创建JNative对象
			n = new JNative("E:\\7V2x_contrast.dll", "TA_Algo_MatchInit_aibo");
			Pointer p1 = new Pointer(
					MemoryBlockFactory.createMemoryBlock(100 * 100));
			Pointer p2 = new Pointer(
					MemoryBlockFactory.createMemoryBlock(100 * 100));
			p1.setIntAt(0, contrast_level);
			p2.setIntAt(0, angle);
			n.setParameter(0, p1);
			n.setParameter(1, p2);
			// 2.设置函数返回值类型
			n.setRetVal(Type.INT);
			n.invoke();
			return n.getRetVal();
		} finally {
			if (n != null) {
				n.dispose();
			}
		}
	}

	/**
	 * 比对
	 * 
	 * @return
	 * @throws NativeException
	 * @throws IllegalAccessException
	 */
	public String ComparisonCard() throws NativeException,
			IllegalAccessException {
		JNative n = null;
		try {
			// 1.创建JNative对象
			n = new JNative("E:\\7V2x_contrast.dll", "TA_Algo_Match_aibo");
			// 2.设置函数返回值类型
			n.setRetVal(Type.INT);
			// 3.设置参数类型

			// 声明指定内存空间
			Pointer p1 = new Pointer(
					MemoryBlockFactory.createMemoryBlock(100 * 100));
			Pointer p2 = new Pointer(
					MemoryBlockFactory.createMemoryBlock(100 * 100));
			int i = 0;
			// aa.setStringAt(0,
			// "D002000000000000000000000000000000001100040808210D0C0A380D130938113407C5C11C930D08B2151714B0992B07C71E3308D65894220C09A0242111F0373406EEB80F021004C43E26077CCC14048CD00E070FD032078014C4540E05948A971B1F8B971D208B171F2415C90000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003C00B1001605FF1D1C1F232A2FFFFFFF23201F22272E3335FFFF2A2826282E35383AFFFF2F30303135393D40FFFF2F3033393D404346FFFF2B2C323F48484A4CFFFF2928294B55515150FFFF28252072615B5755FFFF241F15006C635E5CFFFF1C181105756B6461FFFF16140E077B6F6966FFFF15130E067C726C6AFFFF16130E077E756E6CFFFF17140F08027A736FFFFF16140F0A047D7773FFFF1513100A037C7876FFFF15130F09017A7776FFFF14120E09017A7774FFFF13100D09027D7874FFFF12100C08017C7673FFFF120F0B06017B7671FFFFFF0F0B06007C76FFFFFF212020202122222424262627282A2B2D2D2E2F2F3030303131313232333333333334343401979B1900000000000020BA1D1E11010000000000000000000000000000DBD7000000000000000000000000000000000000");
			// bb.setStringAt(1,
			// "D002000000000000000000000000000000000E000B2B0513122B0926970202209F060C2FD114A10D0934A42F07C5A70809B12D2707C7954DB22F08D2B608069EB81D11F04B3306EE44484C100310D225077C0408141584881415D58C0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003500BB001605FF141515131110FFFFFF1616171716141213FFFF1918191818161717FFFF1A1A191A1B1C1C1CFFFF19191A1C1F242525FFFF1B1B1C20262B2E2FFFFF1E1F20242C313536FFFF2626272B32363A3BFFFF2F303133373C3F42FFFF2F31363B3E424548FFFF2B2D364648484B4DFFFF27262C54514F5051FFFF242014675D575555FFFF1F190E78675F5B59FFFF18150D0072676160FFFF14120D04776D6866FFFF14120D047A706B69FFFF15120E067D746D6BFFFF15130F080178716EFFFF15130E09037D7672FFFF14120F09037C7875FFFFFF120E09027C77FFFFFF1617171617161616151515141312121212121112121111121212131312111112111211120199AE1500000000000019A6171811C100000000000000000000000000002175000000000000000000000000000000000000");
		String s1="D002000000000000000000000000000000001200070D07280B1206300D0B06340F3308BF8945930C0AB5982A09C79C3409D0A10D06A08459222414EA333A05F4B516020C3B2D0680808C481B03884B37067C4B13040B500A050CD40850130390542303794B181E2ACB181E2A99410000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004400B6001605FFFF1D20282E32FFFFFFFF2021252C323436FFFFFF2A292C32363839FFFF31313133363A3C3EFFFF2E30353B3E404446FFFF28292F424B494B4BFFFF2422205F59535151FFFF21201A02665D5855FFFF1D1A14087567605DFFFF1715110A7F716964FFFF15130E0A02776E69FFFF14130F0B037A716DFFFF1715100B047E7672FFFF1714110C06017B77FFFF1513100C07017C79FFFF1412100B067F7A78FFFF13120F0B057E7A78FFFF12100D09047F7B79FFFF110F0C09037F7A77FFFF0E0D0A07037D7875FFFFFF0B0A06017D7975FFFFFFFF0905017D79FFFFFF202223232627282A2B2C2E2F2F2F2F303031313132323333333434343434343535353535019D981900000000000021BA202011010000000000000000000000000000CFBF000000000000000000000000000000000000";
		String s2="D0020000000000000000000000000000000010000B3B04C08E07052D8E3205C0922806BF9105970B18B4190F38D01A2109C71E2B07D05401241B15EA363407EA3911020CBE27057C088CCC1703884F36077C501205065413048C9C480000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004200BF001605FF1E21282D3033FFFFFF2020242B3033363AFFFF25252A2F33363A3EFFFF2D2D2F32363A3E41FFFF333335383C404445FFFF30353C4143474A4BFFFF24294A4E4C4D4E50FFFF1F1A685B56535253FFFF1A137E6A5F5A5757FFFF130F06776A625E5CFFFF0F0D087F71696462FFFF0F0D0901766C6866FFFF120F0B037B716B69FFFF15110C067E76706DFFFF14120D08027B7571FFFF13100D08027B7675FFFF12100D0800797674FFFF12110E08017A7674FFFF12100C09027C7773FFFF100E0B08027C7673FFFF0E0D0A06027C7672FFFFFF0C0A06027C77FFFFFF2A2B2B2C2D2E2E2E2E2F2F2F3030313132323232333334353535363638393A3A3B3C3C3D01951A100000000000001EBA20201181000000000000000000000000000071B4000000000000000000000000000000000000";
			p1.setMemory(s1);
			p2.setMemory(s2);
			n.setParameter(i++, s1);
			n.setParameter(i++, s2);
			// 4.执行函数
			n.invoke();
			// 5.获取函数返回值
			return n.getRetVal();
		} finally {
			if (n != null) {
				n.dispose();
			}
		}
	}
   

	/**
	 * 比对
	 * 
	 * @return
	 * @throws NativeException
	 * @throws IllegalAccessException
	 */
	public String ComparisonCard2() throws NativeException,
			IllegalAccessException {
		JNative n = null;
		try {
			// 1.创建JNative对象
			n = new JNative("E:\\FingerPnt.dll", "MatchTwoFingerPnt");
			// 2.设置函数返回值类型
			n.setRetVal(Type.INT);
			// 声明指定内存空间
			Pointer p1 = new Pointer(
					MemoryBlockFactory.createMemoryBlock(100 * 100));
			Pointer p2 = new Pointer(
					MemoryBlockFactory.createMemoryBlock(100 * 100));
			// 3.设置参数类型
			int i = 0;
		String s1="D002000000000000000000000000000000001200070D07280B1206300D0B06340F3308BF8945930C0AB5982A09C79C3409D0A10D06A08459222414EA333A05F4B516020C3B2D0680808C481B03884B37067C4B13040B500A050CD40850130390542303794B181E2ACB181E2A99410000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004400B6001605FFFF1D20282E32FFFFFFFF2021252C323436FFFFFF2A292C32363839FFFF31313133363A3C3EFFFF2E30353B3E404446FFFF28292F424B494B4BFFFF2422205F59535151FFFF21201A02665D5855FFFF1D1A14087567605DFFFF1715110A7F716964FFFF15130E0A02776E69FFFF14130F0B037A716DFFFF1715100B047E7672FFFF1714110C06017B77FFFF1513100C07017C79FFFF1412100B067F7A78FFFF13120F0B057E7A78FFFF12100D09047F7B79FFFF110F0C09037F7A77FFFF0E0D0A07037D7875FFFFFF0B0A06017D7975FFFFFFFF0905017D79FFFFFF202223232627282A2B2C2E2F2F2F2F303031313132323333333434343434343535353535019D981900000000000021BA202011010000000000000000000000000000CFBF000000000000000000000000000000000000";
		String s2="D0020000000000000000000000000000000010000B3B04C08E07052D8E3205C0922806BF9105970B18B4190F38D01A2109C71E2B07D05401241B15EA363407EA3911020CBE27057C088CCC1703884F36077C501205065413048C9C480000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004200BF001605FF1E21282D3033FFFFFF2020242B3033363AFFFF25252A2F33363A3EFFFF2D2D2F32363A3E41FFFF333335383C404445FFFF30353C4143474A4BFFFF24294A4E4C4D4E50FFFF1F1A685B56535253FFFF1A137E6A5F5A5757FFFF130F06776A625E5CFFFF0F0D087F71696462FFFF0F0D0901766C6866FFFF120F0B037B716B69FFFF15110C067E76706DFFFF14120D08027B7571FFFF13100D08027B7675FFFF12100D0800797674FFFF12110E08017A7674FFFF12100C09027C7773FFFF100E0B08027C7673FFFF0E0D0A06027C7672FFFFFF0C0A06027C77FFFFFF2A2B2B2C2D2E2E2E2E2F2F2F3030313132323232333334353535363638393A3A3B3C3C3D01951A100000000000001EBA20201181000000000000000000000000000071B4000000000000000000000000000000000000";
			p1.setMemory(s1);
			p2.setMemory(s2);
			n.setParameter(i++, p1);
			n.setParameter(i++, p2);
			// 4.执行函数
			n.invoke();
			// 5.获取函数返回值
			return n.getRetVal();
		} finally {
			if (n != null) {
				n.dispose();
			}
		}
	}


	public static void main(String[] args) throws NativeException,
			IllegalAccessException {
		EcardReaderImpl impl = new EcardReaderImpl();
		System.out.println("连接==" + impl.Init(1, 90));
		System.out.println("比对==" + impl.ComparisonCard());
		System.out.println("比对2==" + impl.ComparisonCard2());
	}

}